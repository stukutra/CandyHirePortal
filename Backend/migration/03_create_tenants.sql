-- ============================================
-- Create Tenant Databases (1 to 50) with Schema
-- ============================================
-- Generated automatically by generate_tenant_sql.php
-- Source schema: tenant_schema/schema.sql
-- ============================================

-- Step 1: Create databases
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_1` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_2` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_3` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_4` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_5` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_6` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_7` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_8` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_9` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_10` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_11` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_12` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_13` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_14` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_15` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_16` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_17` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_18` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_19` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_20` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_21` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_22` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_23` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_24` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_25` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_26` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_27` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_28` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_29` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_30` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_31` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_32` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_33` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_34` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_35` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_36` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_37` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_38` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_39` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_40` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_41` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_42` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_43` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_44` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_45` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_46` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_47` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_48` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_49` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE IF NOT EXISTS `candyhire_tenant_50` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Step 2: Apply schema to each database
-- ============================================
-- Tenant 1
-- ============================================
USE `candyhire_tenant_1`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 2
-- ============================================
USE `candyhire_tenant_2`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 3
-- ============================================
USE `candyhire_tenant_3`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 4
-- ============================================
USE `candyhire_tenant_4`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 5
-- ============================================
USE `candyhire_tenant_5`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 6
-- ============================================
USE `candyhire_tenant_6`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 7
-- ============================================
USE `candyhire_tenant_7`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 8
-- ============================================
USE `candyhire_tenant_8`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 9
-- ============================================
USE `candyhire_tenant_9`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 10
-- ============================================
USE `candyhire_tenant_10`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 11
-- ============================================
USE `candyhire_tenant_11`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 12
-- ============================================
USE `candyhire_tenant_12`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 13
-- ============================================
USE `candyhire_tenant_13`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 14
-- ============================================
USE `candyhire_tenant_14`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 15
-- ============================================
USE `candyhire_tenant_15`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 16
-- ============================================
USE `candyhire_tenant_16`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 17
-- ============================================
USE `candyhire_tenant_17`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 18
-- ============================================
USE `candyhire_tenant_18`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 19
-- ============================================
USE `candyhire_tenant_19`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 20
-- ============================================
USE `candyhire_tenant_20`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 21
-- ============================================
USE `candyhire_tenant_21`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 22
-- ============================================
USE `candyhire_tenant_22`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 23
-- ============================================
USE `candyhire_tenant_23`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 24
-- ============================================
USE `candyhire_tenant_24`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 25
-- ============================================
USE `candyhire_tenant_25`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 26
-- ============================================
USE `candyhire_tenant_26`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 27
-- ============================================
USE `candyhire_tenant_27`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 28
-- ============================================
USE `candyhire_tenant_28`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 29
-- ============================================
USE `candyhire_tenant_29`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 30
-- ============================================
USE `candyhire_tenant_30`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 31
-- ============================================
USE `candyhire_tenant_31`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 32
-- ============================================
USE `candyhire_tenant_32`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 33
-- ============================================
USE `candyhire_tenant_33`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 34
-- ============================================
USE `candyhire_tenant_34`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 35
-- ============================================
USE `candyhire_tenant_35`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 36
-- ============================================
USE `candyhire_tenant_36`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 37
-- ============================================
USE `candyhire_tenant_37`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 38
-- ============================================
USE `candyhire_tenant_38`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 39
-- ============================================
USE `candyhire_tenant_39`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 40
-- ============================================
USE `candyhire_tenant_40`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 41
-- ============================================
USE `candyhire_tenant_41`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 42
-- ============================================
USE `candyhire_tenant_42`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 43
-- ============================================
USE `candyhire_tenant_43`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 44
-- ============================================
USE `candyhire_tenant_44`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 45
-- ============================================
USE `candyhire_tenant_45`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 46
-- ============================================
USE `candyhire_tenant_46`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 47
-- ============================================
USE `candyhire_tenant_47`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 48
-- ============================================
USE `candyhire_tenant_48`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 49
-- ============================================
USE `candyhire_tenant_49`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


-- ============================================
-- Tenant 50
-- ============================================
USE `candyhire_tenant_50`;

-- ============================================
-- CandyHire Database Schema - Multi-Tenant
-- MySQL 8.0+
-- tenant_id isolates data between companies
-- ============================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- Table: system_users
-- Users who can login to the system
-- ============================================
DROP TABLE IF EXISTS `system_users`;
CREATE TABLE `system_users` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL COMMENT 'Isolates user data per tenant',
  `email` VARCHAR(255) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `username` VARCHAR(100),
  `avatar` TEXT,
  `role_id` VARCHAR(50),
  `is_active` BOOLEAN DEFAULT TRUE,
  `last_login` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_system_users_tenant (`tenant_id`),
  INDEX idx_system_users_email (`email`),
  INDEX idx_system_users_role (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: roles
-- User roles and permissions
-- ============================================
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `permissions` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_role_name_per_tenant (`name`, `tenant_id`),
  INDEX idx_roles_tenant (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Add foreign key for system_users after roles table is created
ALTER TABLE `system_users`
  ADD FOREIGN KEY (`role_id`) REFERENCES `roles`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- ============================================
-- Table: companies
-- Client companies and suppliers
-- ============================================
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `logo` TEXT,
  `industry` VARCHAR(100) NOT NULL,
  `website` VARCHAR(500),
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `address` VARCHAR(500),
  `city` VARCHAR(100) NOT NULL,
  `country` VARCHAR(100) NOT NULL,
  `employees_count` VARCHAR(50),
  `founded_year` INT,
  `description` TEXT,
  `type` ENUM('Client', 'Supplier', 'Both') NOT NULL DEFAULT 'Client',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_companies_tenant (`tenant_id`),
  INDEX idx_companies_type (`type`),
  INDEX idx_companies_city (`city`),
  INDEX idx_companies_industry (`industry`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: recruiters
-- Internal recruiters/HR staff
-- ============================================
DROP TABLE IF EXISTS `recruiters`;
CREATE TABLE `recruiters` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `role` VARCHAR(100) NOT NULL,
  `department` VARCHAR(100),
  `specialization` VARCHAR(100),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_recruiter_email_per_tenant (`email`, `tenant_id`),
  INDEX idx_recruiters_tenant (`tenant_id`),
  INDEX idx_recruiters_email (`email`),
  INDEX idx_recruiters_role (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: jobs
-- Job openings/positions
-- ============================================
DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `department` VARCHAR(100) NOT NULL,
  `location` VARCHAR(255) NOT NULL,
  `location_type` ENUM('Remote', 'On-site', 'Hybrid') NOT NULL DEFAULT 'Hybrid',
  `job_type` ENUM('Full-time', 'Part-time', 'Contract', 'Internship') NOT NULL DEFAULT 'Full-time',
  `status` ENUM('Open', 'Closed', 'Draft') NOT NULL DEFAULT 'Open',
  `description` TEXT NOT NULL,
  `requirements` TEXT,
  `responsibilities` TEXT,
  `salary_min` DECIMAL(12,2),
  `salary_max` DECIMAL(12,2),
  `salary_currency` VARCHAR(10) DEFAULT 'USD',
  `salary_range` VARCHAR(100),
  `applicants_count` INT DEFAULT 0,
  `posted_date` DATE,
  `start_date` DATE,
  `end_date` DATE,
  `company_id` VARCHAR(50),
  `created_by` VARCHAR(50),
  `employment_type` VARCHAR(50),
  `work_location_type` VARCHAR(50),
  `experience_level` VARCHAR(50),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_jobs_tenant (`tenant_id`),
  INDEX idx_jobs_company (`company_id`),
  INDEX idx_jobs_status (`status`),
  INDEX idx_jobs_type (`job_type`),
  INDEX idx_jobs_location_type (`location_type`),
  INDEX idx_jobs_posted_date (`posted_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_recruiters (Many-to-Many)
-- Assigns recruiters to jobs
-- ============================================
DROP TABLE IF EXISTS `job_recruiters`;
CREATE TABLE `job_recruiters` (
  `job_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`, `recruiter_id`),
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_job_recruiters_job (`job_id`),
  INDEX idx_job_recruiters_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidates
-- Job candidates/applicants
-- ============================================
DROP TABLE IF EXISTS `candidates`;
CREATE TABLE `candidates` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50),
  `avatar` TEXT,
  `resume_url` TEXT,
  `cover_letter` TEXT,
  `linkedin` VARCHAR(500),
  `portfolio` VARCHAR(500),
  `skills` JSON,
  `experience` INT DEFAULT 0 COMMENT 'Years of experience',
  `current_position` VARCHAR(255),
  `current_company` VARCHAR(255),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `rating` TINYINT CHECK (`rating` >= 1 AND `rating` <= 5),
  `candidate_type` ENUM('Employee', 'Freelancer', 'Supplier') NOT NULL DEFAULT 'Employee',
  `daily_rate` DECIMAL(10,2) COMMENT 'For freelancers in EUR',
  `annual_salary` DECIMAL(12,2) COMMENT 'For employees RAL in EUR',
  `expected_salary` DECIMAL(12,2) COMMENT 'Expected annual or daily rate',
  `supplier_company_id` VARCHAR(50),
  `supplier_company_name` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`supplier_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_candidates_tenant (`tenant_id`),
  INDEX idx_candidates_email (`email`),
  INDEX idx_candidates_status (`status`),
  INDEX idx_candidates_type (`candidate_type`),
  INDEX idx_candidates_supplier (`supplier_company_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_applications (Many-to-Many)
-- Links candidates to jobs they applied for
-- ============================================
DROP TABLE IF EXISTS `job_applications`;
CREATE TABLE `job_applications` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `job_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50),
  `status` ENUM('New', 'Screening', 'Interview', 'Offer', 'Hired', 'Rejected') NOT NULL DEFAULT 'New',
  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `referral_company_id` VARCHAR(50),
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`referral_company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_job_applications_tenant (`tenant_id`),
  INDEX idx_job_applications_candidate (`candidate_id`),
  INDEX idx_job_applications_job (`job_id`),
  INDEX idx_job_applications_status (`status`),
  INDEX idx_job_applications_applied_at (`applied_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: job_application_recruiters (Many-to-Many)
-- Assigns recruiters to job applications
-- ============================================
DROP TABLE IF EXISTS `job_application_recruiters`;
CREATE TABLE `job_application_recruiters` (
  `job_application_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `assigned_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_application_id`, `recruiter_id`),
  FOREIGN KEY (`job_application_id`) REFERENCES `job_applications`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: candidate_notes
-- Notes about candidates
-- ============================================
DROP TABLE IF EXISTS `candidate_notes`;
CREATE TABLE `candidate_notes` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  `recruiter_name` VARCHAR(255) NOT NULL,
  `recruiter_avatar` TEXT,
  `content` TEXT NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_candidate_notes_tenant (`tenant_id`),
  INDEX idx_candidate_notes_candidate (`candidate_id`),
  INDEX idx_candidate_notes_recruiter (`recruiter_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interviews
-- Interview schedules
-- ============================================
DROP TABLE IF EXISTS `interviews`;
CREATE TABLE `interviews` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `candidate_id` VARCHAR(50) NOT NULL,
  `candidate_name` VARCHAR(255) NOT NULL,
  `job_id` VARCHAR(50),
  `job_title` VARCHAR(255),
  `company_id` VARCHAR(50),
  `company_name` VARCHAR(255),
  `type` ENUM('Phone', 'Video', 'In-person', 'Technical') NOT NULL DEFAULT 'Video',
  `status` ENUM('Scheduled', 'Completed', 'Cancelled', 'Rescheduled') NOT NULL DEFAULT 'Scheduled',
  `scheduled_at` TIMESTAMP NOT NULL,
  `duration` INT NOT NULL COMMENT 'Duration in minutes',
  `location` VARCHAR(500),
  `meeting_link` TEXT,
  `notes` TEXT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`candidate_id`) REFERENCES `candidates`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`job_id`) REFERENCES `jobs`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_interviews_tenant (`tenant_id`),
  INDEX idx_interviews_candidate (`candidate_id`),
  INDEX idx_interviews_job (`job_id`),
  INDEX idx_interviews_status (`status`),
  INDEX idx_interviews_scheduled (`scheduled_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_interviewers (Many-to-Many)
-- Assigns interviewers to interviews
-- ============================================
DROP TABLE IF EXISTS `interview_interviewers`;
CREATE TABLE `interview_interviewers` (
  `interview_id` VARCHAR(50) NOT NULL,
  `recruiter_id` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`interview_id`, `recruiter_id`),
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`recruiter_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: interview_feedback
-- Feedback from interviewers
-- ============================================
DROP TABLE IF EXISTS `interview_feedback`;
CREATE TABLE `interview_feedback` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `interview_id` VARCHAR(50) NOT NULL,
  `interviewer_id` VARCHAR(50) NOT NULL,
  `rating` TINYINT NOT NULL CHECK (`rating` >= 1 AND `rating` <= 5),
  `comments` TEXT NOT NULL,
  `recommendation` ENUM('Hire', 'Maybe', 'No Hire') NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`interview_id`) REFERENCES `interviews`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`interviewer_id`) REFERENCES `recruiters`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_feedback_tenant (`tenant_id`),
  INDEX idx_feedback_interview (`interview_id`),
  INDEX idx_feedback_interviewer (`interviewer_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: referents
-- Company contact persons
-- ============================================
DROP TABLE IF EXISTS `referents`;
CREATE TABLE `referents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `company_id` VARCHAR(50) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `role` ENUM('HR Manager', 'HR Director', 'Recruiting Manager', 'Talent Acquisition', 'Department Head', 'Account Manager', 'Sales Manager', 'Business Partner', 'Operations Manager') NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`company_id`) REFERENCES `companies`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_referents_tenant (`tenant_id`),
  INDEX idx_referents_company (`company_id`),
  INDEX idx_referents_email (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: blacklist
-- Blacklisted entities
-- ============================================
DROP TABLE IF EXISTS `blacklist`;
CREATE TABLE `blacklist` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `entity_name` VARCHAR(255) NOT NULL,
  `reason` TEXT NOT NULL,
  `added_by` VARCHAR(50),
  `added_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_permanent` BOOLEAN DEFAULT FALSE,
  `expires_at` TIMESTAMP NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_blacklist_tenant (`tenant_id`),
  INDEX idx_blacklist_entity (`entity_type`, `entity_id`),
  INDEX idx_blacklist_added_by (`added_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: document_types
-- Types of documents that can be uploaded
-- ============================================
DROP TABLE IF EXISTS `document_types`;
CREATE TABLE `document_types` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `description` TEXT,
  `icon` VARCHAR(100),
  `accepted_formats` JSON NOT NULL COMMENT 'Array of MIME types',
  `max_size_mb` INT NOT NULL DEFAULT 10,
  `is_required` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_document_types_tenant (`tenant_id`),
  INDEX idx_document_types_entity (`entity_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: documents
-- Uploaded documents
-- ============================================
DROP TABLE IF EXISTS `documents`;
CREATE TABLE `documents` (
  `id` VARCHAR(50) NOT NULL PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` ENUM('candidate', 'company', 'job', 'interview', 'recruiter') NOT NULL,
  `entity_id` VARCHAR(50) NOT NULL,
  `document_type_id` VARCHAR(50) NOT NULL,
  `document_type_name` VARCHAR(100) NOT NULL,
  `file_name` VARCHAR(500) NOT NULL,
  `file_size` BIGINT NOT NULL COMMENT 'Size in bytes',
  `file_type` VARCHAR(100) NOT NULL COMMENT 'MIME type',
  `file_url` TEXT NOT NULL,
  `uploaded_by` VARCHAR(50) NOT NULL,
  `uploader_name` VARCHAR(255) NOT NULL,
  `notes` TEXT,
  `uploaded_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`document_type_id`) REFERENCES `document_types`(`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
  INDEX idx_documents_tenant (`tenant_id`),
  INDEX idx_documents_entity (`entity_type`, `entity_id`),
  INDEX idx_documents_type (`document_type_id`),
  INDEX idx_documents_uploaded_by (`uploaded_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ============================================
-- Table: activity_logs
-- Audit trail of all activities
-- ============================================
DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `tenant_id` VARCHAR(50) NOT NULL,
  `entity_type` VARCHAR(50) NOT NULL,
  `entity_id` VARCHAR(50),
  `action` VARCHAR(100) NOT NULL,
  `user_id` VARCHAR(50),
  `user_email` VARCHAR(255),
  `ip_address` VARCHAR(45),
  `user_agent` TEXT,
  `metadata` JSON,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_activity_logs_tenant (`tenant_id`),
  INDEX idx_activity_logs_entity (`entity_type`, `entity_id`),
  INDEX idx_activity_logs_action (`action`),
  INDEX idx_activity_logs_user (`user_id`),
  INDEX idx_activity_logs_created (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- ============================================
-- End of Multi-Tenant Schema
-- ============================================


