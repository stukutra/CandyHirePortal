# Schema Changes - AUTO_INCREMENT Implementation

## Summary
All main entity tables in the tenant schema now use `BIGINT UNSIGNED AUTO_INCREMENT` for primary keys instead of manually generated VARCHAR IDs.

## Changes Made

### 1. Tenant Schema (`tenant_schema/schema.sql`)

#### Tables Updated to Use AUTO_INCREMENT:

1. **roles** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
2. **system_users** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `role_id`: VARCHAR(50) → BIGINT UNSIGNED
3. **companies** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
4. **recruiters** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
5. **jobs** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `company_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `created_by`: VARCHAR(50) → BIGINT UNSIGNED
6. **candidates** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `supplier_company_id`: VARCHAR(50) → BIGINT UNSIGNED
7. **job_applications** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `candidate_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `job_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `company_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `referral_company_id`: VARCHAR(50) → BIGINT UNSIGNED
8. **candidate_notes** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `candidate_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `recruiter_id`: VARCHAR(50) → BIGINT UNSIGNED
9. **interviews** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
   - `candidate_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `job_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `company_id`: VARCHAR(50) → BIGINT UNSIGNED
10. **interview_feedback** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
    - `interview_id`: VARCHAR(50) → BIGINT UNSIGNED
    - `interviewer_id`: VARCHAR(50) → BIGINT UNSIGNED
11. **referents** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
    - `company_id`: VARCHAR(50) → BIGINT UNSIGNED
12. **blacklist** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
    - `entity_id`: VARCHAR(50) → BIGINT UNSIGNED
    - `added_by`: VARCHAR(50) → BIGINT UNSIGNED
13. **document_types** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
14. **documents** - `id`: VARCHAR(50) → BIGINT UNSIGNED AUTO_INCREMENT
    - `entity_id`: VARCHAR(50) → BIGINT UNSIGNED
    - `document_type_id`: VARCHAR(50) → BIGINT UNSIGNED
    - `uploaded_by`: VARCHAR(50) → BIGINT UNSIGNED
15. **activity_logs** - `id`: BIGINT → BIGINT UNSIGNED
    - `entity_id`: VARCHAR(50) → BIGINT UNSIGNED
    - `user_id`: VARCHAR(50) → BIGINT UNSIGNED

#### Junction Tables Updated:

1. **job_recruiters**
   - `job_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `recruiter_id`: VARCHAR(50) → BIGINT UNSIGNED

2. **job_application_recruiters**
   - `job_application_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `recruiter_id`: VARCHAR(50) → BIGINT UNSIGNED

3. **interview_interviewers**
   - `interview_id`: VARCHAR(50) → BIGINT UNSIGNED
   - `recruiter_id`: VARCHAR(50) → BIGINT UNSIGNED

### 2. API Code Changes

#### CandyHire Backend APIs Updated:

**Recruiter Model** (`/Users/guidosalzano/Documents/MyProject/CandyHireSuite/CandyHire/Backend/api/models/Recruiter.php`):
- Removed manual ID generation from `create()` method
- Added `lastInsertId()` to capture auto-generated ID
- ID is now automatically generated by database

**Recruiter API** (`/Users/guidosalzano/Documents/MyProject/CandyHireSuite/CandyHire/Backend/api/recruiters/index.php`):
- Removed manual ID generation line: `$recruiter->id = 'REC-' . uniqid() . '-' . substr(md5($data->email . time()), 0, 8);`
- Database now handles ID generation automatically

### 3. Migration Files Cleanup

**Removed from CandyHire Project**:
- `04_candyhire_schema.sql` (moved to Portal)
- `05_fix_recruiters_id.sql` (obsolete migration attempt)
- `05_fix_recruiters_id_tenant.sql` (obsolete migration attempt)

**Kept in CandyHire Project**:
- `01_grant_permissions.sql` (tenant database access permissions)

### 4. New Migration File Created

**Portal Project** (`05_alter_recruiters_auto_increment.sql`):
- Migration script to convert existing databases from VARCHAR IDs to BIGINT AUTO_INCREMENT
- Handles data migration and foreign key updates
- Note: This migration is for reference only. Use `setup.sh` to rebuild databases from scratch.

## How to Apply Changes

### Option 1: Fresh Database Setup (Recommended)
Run the setup script to rebuild all tenant databases:
```bash
cd /Users/guidosalzano/Documents/MyProject/CandyHireSuite/CandyHirePortal/Backend
./setup.sh
```

### Option 2: Regenerate Tenant SQL
Generate new tenant creation SQL files:
```bash
cd /Users/guidosalzano/Documents/MyProject/CandyHireSuite/CandyHirePortal/Backend/migration
php generate_tenant_sql.php 1 100 03_create_tenants_new.sql
```

Then apply the generated SQL:
```bash
mysql -uroot -p < 03_create_tenants_new.sql
```

## Benefits

1. **Performance**: BIGINT AUTO_INCREMENT is faster than string-based IDs
2. **Storage**: BIGINT UNSIGNED (8 bytes) is smaller than VARCHAR(50) (up to 50 bytes)
3. **Consistency**: All IDs follow same pattern across all tables
4. **Simplicity**: No manual ID generation code needed
5. **Database-Level**: ID generation happens at database level, not application level
6. **Standards**: Follows standard database design practices

## Notes

- All IDs use `BIGINT UNSIGNED` which supports values from 0 to 18,446,744,073,709,551,615
- Auto-increment IDs start from 1 by default
- Foreign key relationships are properly maintained with CASCADE/SET NULL
- The schema properly handles table drop order with `SET FOREIGN_KEY_CHECKS = 0`

## Testing Checklist

After rebuilding the database:
- [ ] Verify all tables exist with correct structure
- [ ] Test creating recruiters via API (should use auto-increment ID)
- [ ] Test creating other entities (companies, jobs, candidates, etc.)
- [ ] Verify foreign key relationships work correctly
- [ ] Check junction tables (job_recruiters, etc.) accept new ID format
- [ ] Test API responses return numeric IDs instead of string IDs
- [ ] Update frontend TypeScript models if IDs are typed as strings
